<?xml version="1.0"?>
<!--
Central Hexapod Robot Component Orchestrator

This is the main assembly file that orchestrates all hexapod robot components.
It includes and instantiates all major subsystems:
- Robot structure (legs, platform, joints)
- Physics configuration (Gazebo properties)
- Control system (ros2_control interfaces)
- Sensor systems (IMU, contact sensors)
- Simulation plugins (touch detection, control integration)
-->
<robot name="hexapod" xmlns:xacro="http://ros.org/wiki/xacro">
  <xacro:macro name="hexapod_ee" params="use_sim use_gazebo use_fake_hardware">
    
    <!-- COMPONENT INCLUDES                                                -->
    <!-- Gazebo physics -->
    <xacro:include filename="$(find hexapod_model_description)/gazebo/hexapod.gazebo.xacro" />
    
    <!-- Robot structural components (legs, platform, joints) -->
    <xacro:include filename="$(find hexapod_model_description)/urdf/hexapod_leg_ee.urdf.xacro" />
    
    <!-- IMU sensor definition (currently unused) -->
    <!-- <xacro:include filename="$(find hexapod_model_description)/urdf/imu.urdf.xacro"/> -->
    
    <!-- ros2_control hardware interface configuration -->
    <xacro:include filename="$(find hexapod_model_description)/control/hexapod.ros2_control.xacro" />

    <!-- ROBOT STRUCTURE INSTANTIATION                                     -->
    <!-- Create complete robot structure with legs and platform -->
    <xacro:hexapod_leg_ee/>
    
    <!-- Apply Gazebo physics properties and transmissions -->
    <xacro:hexapod_gazebo/>
    
    <!-- GAZEBO SIMULATION PLUGINS                                         -->
    <!-- ros2_control integration plugin for Gazebo -->
    <gazebo>
      <plugin filename="gz_ros2_control-system" name="gz_ros2_control::GazeboSimROS2ControlPlugin">
        <parameters>$(find hexapod_model_description)/control/controller_manager.yaml</parameters>
      </plugin>
    </gazebo>

    <!-- Touch/contact detection plugin for ground interaction
    <gazebo>
      <plugin filename="gz-sim-touchplugin-system"
        name="gz::sim::systems::TouchPlugin">
          <target>ground_plane</target>
          <time>0.001</time>
          <enabled>true</enabled>
      </plugin>
    </gazebo>  -->
    
    <!-- CONTROL SYSTEM CONFIGURATION                                      -->    
    <!-- ros2_control hardware interface with parameter selection -->
    <xacro:hexapod_ros2_control 
        name="hexapod" 
        initial_positions_file="$(find hexapod_model_description)/config/initial_positions.yaml" 
        use_gazebo="${use_gazebo}" 
        use_fake_hardware="${use_fake_hardware}"/>
  </xacro:macro>
</robot>